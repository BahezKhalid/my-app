<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clinic System - Secure Admin</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #0284c7; --bg: #fdfdfd; --card: #ffffff; --text: #1e293b; --border: #e2e8f0; --price-bg: #f0f9ff; }
        [data-theme='dark'] { --bg: #0f172a; --card: #1e293b; --text: #f8fafc; --border: #334155; --price-bg: #0c4a6e; }
        * { box-sizing: border-box; font-family: 'Noto Sans Arabic', sans-serif; transition: 0.2s; }
        body { background: var(--bg); color: var(--text); margin: 0; padding: 10px; padding-bottom: 100px; }
        
        header { display: flex; justify-content: space-between; align-items: center; padding: 10px; background: var(--card); border: 1px solid var(--border); border-radius: 10px; margin-bottom: 15px; }
        .lang-btns button { border: 1px solid var(--border); background: var(--card); padding: 4px 8px; border-radius: 5px; cursor: pointer; font-size: 0.7rem; color: var(--text); margin: 0 2px; }
        
        /* Admin Search Bar */
        .search-wrapper { margin-bottom: 15px; }
        .search-input { width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 8px; background: var(--card); color: var(--text); outline: none; }

        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(105px, 1fr)); gap: 10px; margin-bottom: 20px; }
        .card { background: var(--card); border: 1px solid var(--border); border-radius: 10px; padding: 12px 5px; text-align: center; cursor: pointer; display: flex; flex-direction: column; justify-content: space-between; min-height: 110px; }
        .card:hover { border-color: var(--primary); transform: translateY(-2px); }
        .card h3 { font-size: 0.85rem; margin: 0; }
        
        .price-tag { background: var(--price-bg); color: var(--primary); font-size: 0.7rem; font-weight: bold; padding: 4px 0; border-radius: 6px; margin-top: 5px; }
        .table-section { background: var(--card); border: 1px solid var(--border); border-radius: 10px; overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; font-size: 0.7rem; min-width: 500px; }
        th, td { padding: 10px; border-bottom: 1px solid var(--border); text-align: inherit; }

        #loginOverlay { position: fixed; inset: 0; background: var(--bg); display: flex; align-items: center; justify-content: center; z-index: 2000; }
        .hidden { display: none !important; }
        .btn-confirm { background: var(--primary); color: white; border: none; padding: 10px; width: 100%; border-radius: 8px; cursor: pointer; font-weight: bold; }
        #modal { position: fixed; inset: 0; background: rgba(0,0,0,0.4); display: none; align-items: center; justify-content: center; z-index: 1000; }
        .modal-box { background: var(--card); border: 1px solid var(--border); padding: 20px; border-radius: 15px; width: 300px; }
        input { width: 100%; padding: 10px; margin: 6px 0; border: 1px solid var(--border); border-radius: 8px; background: var(--bg); color: var(--text); }
    </style>
</head>
<body class="rtl">

    <div id="loginOverlay">
        <div class="modal-box" style="text-align: center;">
            <h3 id="welcomeMsg">Welcome / Ø£Ù‡Ù„Ø§Ù‹ Ø¨ÙƒÙ…</h3>
            <button class="btn-confirm" onclick="checkAdmin()">Admin (Login)</button>
            <button class="btn-confirm" onclick="login('guest')" style="background: #64748b; margin-top: 10px;">Guest (Booking Only)</button>
        </div>
    </div>

    <header>
        <div>
            <span id="roleDisplay" style="font-size:0.7rem; font-weight:bold; color:var(--primary);"></span>
            <button onclick="location.reload()" style="font-size: 0.6rem; cursor:pointer;">Logout</button>
        </div>
        <div class="lang-btns">
            <button onclick="setLang('ar')">Ø¹Ø±Ø¨ÙŠ</button>
            <button onclick="setLang('ku')">Ú©ÙˆØ±Ø¯ÛŒ</button>
            <button onclick="setLang('en')">EN</button>
        </div>
        <div onclick="toggleTheme()" style="cursor:pointer; font-size: 1.1rem;">ðŸŒ“</div>
    </header>

    <div class="grid" id="doctorsGrid"></div>

    <div id="adminArea" class="hidden">
        <div class="search-wrapper">
            <input type="text" id="searchInput" class="search-input" placeholder="Search..." onkeyup="filterTable()">
        </div>
        <div class="table-section">
            <table>
                <thead><tr id="tableHead"></tr></thead>
                <tbody id="apptBody"></tbody>
            </table>
        </div>
    </div>

    <div id="modal">
        <div class="modal-box">
            <h4 id="mTitle" style="margin:0 0 10px 0; text-align:center;"></h4>
            <input type="text" id="pName">
            <input type="number" id="pAge">
            <input type="datetime-local" id="pTime">
            <button class="btn-confirm" onclick="confirmBooking()" id="btnSave"></button>
            <button onclick="closeModal()" style="background:none; border:none; color:#94a3b8; width:100%; margin-top:10px; cursor:pointer; font-size: 0.75rem;">Cancel</button>
        </div>
    </div>

    <script>
        let lang = 'ar', selDoc = null, currentUserRole = null;
        let db = JSON.parse(localStorage.getItem('clinic_final_v11')) || [];

        const ui = {
            ar: { cols: ["#", "Ø§Ù„Ù…Ø±ÙŠØ¶", "Ø§Ù„Ø¹Ù…Ø±", "Ø§Ù„Ø·Ø¨ÙŠØ¨", "Ø§Ù„ÙˆÙ‚Øª", "Ø§Ù„Ø³Ø¹Ø±", "X"], search: "Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯...", success: "ØªÙ… Ø§Ù„Ø­Ø¬Ø²!", loginErr: "ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø©!" },
            ku: { cols: ["#", "Ù†Û•Ø®Û†Ø´", "ØªÛ•Ù…Û•Ù†", "Ù¾Ø²ÛŒØ´Ú©", "Ú©Ø§Øª", "Ù†Ø±Ø®", "X"], search: "Ú¯Û•Ú•Ø§Ù†...", success: "Ø­Ø¬Ø² Ú©Ø±Ø§!", loginErr: "Ù¾Ø§Ø³Û†Ø±Ø¯ Ù‡Û•ÚµÛ•ÛŒÛ•!" },
            en: { cols: ["#", "Patient", "Age", "Doctor", "Time", "Price", "X"], search: "Search...", success: "Booked!", loginErr: "Wrong Password!" }
        };

        const docList = [
            { id: 1, name: "Ø¯. Ø£Ø­Ù…Ø¯", spec: "Ù‚Ù„Ø¨ÙŠØ©", price: "15,000" },
            { id: 2, name: "Ø¯. Ø³Ø§Ø±Ø©", spec: "Ø£Ø·ÙØ§Ù„", price: "10,000" },
            { id: 3, name: "Ø¯. Ø®Ø§Ù„Ø¯", spec: "Ø£Ø³Ù†Ø§Ù†", price: "15,000" },
            { id: 4, name: "Ø¯. Ù…Ù†Ù‰", spec: "Ø¹ÙŠÙˆÙ†", price: "12,000" },
            { id: 5, name: "Ø¯. Ø¹Ù…Ø±", spec: "Ø£Ø¹ØµØ§Ø¨", price: "15,000" },
            { id: 6, name: "Ø¯. Ø³Û†Ø²Ø§Ù†", spec: "Ù†Ø³Ø§Ø¦ÙŠØ©", price: "15,000" },
            { id: 7, name: "Ø¯. Ù‡ÛŽÙ…Ù†", spec: "Ø¹Ø§Ù…", price: "5,000" }
        ];

        // NEW: Password Protected Admin Login
        function checkAdmin() {
            const pass = prompt("Enter Admin Password / Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:");
            if (pass === "9898") {
                login('admin');
            } else {
                alert(ui[lang].loginErr);
            }
        }

        function login(role) {
            currentUserRole = role;
            document.getElementById('loginOverlay').style.display = 'none';
            document.getElementById('roleDisplay').innerText = role.toUpperCase();
            if(role === 'admin') document.getElementById('adminArea').classList.remove('hidden');
            render();
        }

        function setLang(l) { lang = l; render(); }

        function render() {
            if(!currentUserRole) return;
            document.body.className = lang === 'en' ? 'ltr' : 'rtl';
            document.getElementById('tableHead').innerHTML = ui[lang].cols.map(c => `<th>${c}</th>`).join('');
            document.getElementById('searchInput').placeholder = ui[lang].search;
            
            document.getElementById('doctorsGrid').innerHTML = docList.map(doc => `
                <div class="card" onclick="openModal(${doc.id})">
                    <h3>${doc.name}</h3><p style="font-size:0.6rem; color:#94a3b8; margin:0;">${doc.spec}</p>
                    <div class="price-tag">${doc.price} IQD</div>
                </div>
            `).join('');
            updateTable();
        }

        function filterTable() {
            let input = document.getElementById("searchInput").value.toLowerCase();
            let rows = document.querySelectorAll("#apptBody tr");
            rows.forEach(row => {
                row.style.display = row.innerText.toLowerCase().includes(input) ? "" : "none";
            });
        }

        function openModal(id) { 
            selDoc = docList.find(x => x.id === id); 
            document.getElementById('mTitle').innerText = selDoc.name;
            document.getElementById('modal').style.display = 'flex'; 
        }
        
        function closeModal() { document.getElementById('modal').style.display = 'none'; }

        function confirmBooking() {
            const name = document.getElementById('pName').value, age = document.getElementById('pAge').value, time = document.getElementById('pTime').value;
            if(!name || !age || !time) return;
            
            db.push({ id: Date.now(), tkt: db.length + 1, user: name, age: age, doc: selDoc.name, price: selDoc.price, time: time });
            localStorage.setItem('clinic_final_v11', JSON.stringify(db));
            alert(ui[lang].success);
            closeModal(); updateTable();
        }

        function updateTable() {
            if(currentUserRole !== 'admin') return;
            const body = document.getElementById('apptBody');
            body.innerHTML = db.map(a => `
                <tr>
                    <td><span class="tkt">#${a.tkt}</span></td>
                    <td>${a.user}</td><td>${a.age}</td><td><strong>${a.doc}</strong></td>
                    <td>${a.time}</td><td>${a.price}</td>
                    <td><button onclick="del(${a.id})" style="color:red; border:none; background:none; cursor:pointer; font-weight:bold;">X</button></td>
                </tr>
            `).join('');
        }

        function del(id) {
            if(!confirm("Delete?")) return;
            db = db.filter(x => x.id !== id);
            localStorage.setItem('clinic_final_v11', JSON.stringify(db));
            updateTable();
        }

        function toggleTheme() {
            const b = document.body;
            b.getAttribute('data-theme') === 'dark' ? b.removeAttribute('data-theme') : b.setAttribute('data-theme', 'dark');
        }
    </script>
</body>
</html>
