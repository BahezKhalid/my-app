<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clinic System - Live Sync</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #0284c7; --bg: #fdfdfd; --card: #ffffff; --text: #1e293b; --border: #e2e8f0; --price-bg: #f0f9ff; }
        [data-theme='dark'] { --bg: #0f172a; --card: #1e293b; --text: #f8fafc; --border: #334155; --price-bg: #0c4a6e; }
        * { box-sizing: border-box; font-family: 'Noto Sans Arabic', sans-serif; transition: 0.2s; }
        body { background: var(--bg); color: var(--text); margin: 0; padding: 10px; padding-bottom: 100px; }
        
        header { display: flex; justify-content: space-between; align-items: center; padding: 10px; background: var(--card); border: 1px solid var(--border); border-radius: 10px; margin-bottom: 15px; }
        .lang-btns button { border: 1px solid var(--border); background: var(--card); padding: 5px 10px; border-radius: 5px; cursor: pointer; color: var(--text); font-weight: bold; font-size: 0.7rem; }
        
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(110px, 1fr)); gap: 10px; margin-bottom: 20px; }
        .card { background: var(--card); border: 1px solid var(--border); border-radius: 10px; padding: 12px 5px; text-align: center; cursor: pointer; min-height: 120px; }
        .card:hover { border-color: var(--primary); transform: translateY(-2px); }
        .price-tag { background: var(--price-bg); color: var(--primary); font-size: 0.7rem; font-weight: bold; padding: 4px 0; border-radius: 6px; margin-top: 8px; }

        .table-section { background: var(--card); border: 1px solid var(--border); border-radius: 10px; overflow-x: auto; margin-top: 10px; }
        table { width: 100%; border-collapse: collapse; font-size: 0.75rem; min-width: 600px; }
        th, td { padding: 12px 10px; border-bottom: 1px solid var(--border); text-align: inherit; }
        th { background: rgba(0,0,0,0.03); }

        #loginOverlay, #modal, #receiptModal { position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: none; align-items: center; justify-content: center; z-index: 2000; padding: 20px; }
        .modal-box { background: var(--card); padding: 25px; border-radius: 15px; width: 100%; max-width: 350px; text-align: center; }
        input { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid var(--border); border-radius: 8px; background: var(--bg); color: var(--text); }
        .btn-confirm { background: var(--primary); color: white; border: none; padding: 12px; width: 100%; border-radius: 8px; cursor: pointer; font-weight: bold; }
        
        .receipt { border: 2px dashed #ccc; padding: 20px; background: white; color: black; border-radius: 10px; margin-bottom: 15px; text-align: right; }
        .receipt-item { display: flex; justify-content: space-between; border-bottom: 1px solid #eee; padding: 8px 0; }

        .hidden { display: none !important; }
        .ltr { direction: ltr; } .rtl { direction: rtl; }

        @media print {
            body * { visibility: hidden; }
            #receiptArea, #receiptArea * { visibility: visible; }
            #receiptArea { position: absolute; left: 0; top: 0; width: 100%; border: none; }
        }
    </style>
</head>
<body class="rtl">

    <div id="loginOverlay" style="display: flex;">
        <div class="modal-box">
            <h2 style="margin-top:0;">Clinic System</h2>
            <button class="btn-confirm" onclick="checkAdmin()">Admin (9898)</button>
            <button class="btn-confirm" onclick="login('guest')" style="background: #64748b; margin-top: 10px;">Guest / Ù…ÛŒÙˆØ§Ù† / Ø²Ø§Ø¦Ø±</button>
        </div>
    </div>

    <header>
        <div>
            <span id="roleDisplay" style="font-size:0.75rem; font-weight:bold; color:var(--primary); background:var(--price-bg); padding:2px 8px; border-radius:5px;"></span>
            <button onclick="logout()" id="btnLogout" style="font-size:0.6rem; cursor:pointer; background:none; border:1px solid var(--border); color:var(--text); border-radius:4px; margin-right:5px;"></button>
        </div>
        <div class="lang-btns">
            <button onclick="setLang('ar')">Ø¹Ø±Ø¨ÙŠ</button>
            <button onclick="setLang('ku')">Ú©ÙˆØ±Ø¯ÛŒ</button>
            <button onclick="setLang('en')">EN</button>
        </div>
        <div onclick="toggleTheme()" style="cursor:pointer; font-size: 1.2rem;">ğŸŒ“</div>
    </header>

    <div class="grid" id="doctorsGrid"></div>

    <div id="adminArea" class="hidden">
        <input type="text" id="searchInput" onkeyup="filterTable()" placeholder="..." style="width:100%; padding:12px; border-radius:8px; border:1px solid var(--border); background:var(--card); color:var(--text);">
        <div class="table-section">
            <table>
                <thead><tr id="tableHead"></tr></thead>
                <tbody id="apptBody"></tbody>
            </table>
        </div>
    </div>

    <div id="modal">
        <div class="modal-box">
            <h3 id="mTitle" style="color:var(--primary); margin-top:0;"></h3>
            <input type="text" id="pName">
            <input type="number" id="pAge">
            <input type="datetime-local" id="pTime">
            <button class="btn-confirm" onclick="confirmBooking()" id="btnSave"></button>
            <button onclick="closeModal()" id="btnCancel" style="background:none; border:none; color:#94a3b8; width:100%; margin-top:10px; cursor:pointer;"></button>
        </div>
    </div>

    <div id="receiptModal">
        <div class="modal-box">
            <div id="receiptArea" class="receipt">
                <h3 style="text-align:center; margin:0;">CLINIC TICKET</h3>
                <hr>
                <div class="receipt-item"><span id="rLabName"></span>: <b id="rName"></b></div>
                <div class="receipt-item"><span id="rLabDoc"></span>: <b id="rDoc"></b></div>
                <div class="receipt-item"><span id="rLabTime"></span>: <b id="rTime"></b></div>
                <div class="receipt-item"><span id="rLabPrice"></span>: <b id="rPrice"></b></div>
                <p style="font-size:0.6rem; text-align:center; margin-top:15px; color:#888;">Developed by @BahezKhalidAudl</p>
            </div>
            <button class="btn-confirm" onclick="window.print()">Print / Ø·Ø¨Ø§Ø¹Ø©</button>
            <button onclick="document.getElementById('receiptModal').style.display='none'" style="margin-top:10px; background:none; border:none; color:#94a3b8; cursor:pointer;">Close</button>
        </div>
    </div>

    <script>
        let lang = 'ar', selDoc = null, currentUserRole = null;
        let db = JSON.parse(localStorage.getItem('clinic_final_v11')) || [];

        const ui = {
            ar: {
                roleAdmin: "Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…", roleGuest: "Ø­Ø¬Ø² Ø²Ø§Ø¦Ø±", logout: "Ø®Ø±ÙˆØ¬",
                mName: "Ø§Ø³Ù… Ø§Ù„Ù…Ø±ÙŠØ¶ Ø§Ù„ÙƒØ§Ù…Ù„", mAge: "Ø§Ù„Ø¹Ù…Ø±", btnSave: "ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø¬Ø²", btnCancel: "Ø¥Ù„ØºØ§Ø¡",
                rName: "Ø§Ù„Ø§Ø³Ù…", rDoc: "Ø§Ù„Ø·Ø¨ÙŠØ¨", rTime: "Ø§Ù„Ù…ÙˆØ¹Ø¯", rPrice: "Ø§Ù„Ø³Ø¹Ø±", search: "Ø¨Ø­Ø« ÙÙŠ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯...",
                cols: ["ØªÙƒØª#", "Ø§Ù„Ù…Ø±ÙŠØ¶", "Ø§Ù„Ø¹Ù…Ø±", "Ø§Ù„Ø·Ø¨ÙŠØ¨", "Ø§Ù„ÙˆÙ‚Øª", "Ø§Ù„Ø³Ø¹Ø±", "Ø­Ø°Ù"],
                doctors: [
                    { id: 1, name: "Ø¯. Ø£Ø­Ù…Ø¯", spec: "Ù‚Ù„Ø¨ÙŠØ©", price: "15,000" },
                    { id: 2, name: "Ø¯. Ø³Ø§Ø±Ø©", spec: "Ø£Ø·ÙØ§Ù„", price: "10,000" },
                    { id: 3, name: "Ø¯. Ø®Ø§Ù„Ø¯", spec: "Ø£Ø³Ù†Ø§Ù†", price: "15,000" },
                    { id: 4, name: "Ø¯. Ù‡ÛÙ…Ù†", spec: "Ø¹Ø§Ù…", price: "5,000" }
                ]
            },
            ku: {
                roleAdmin: "Ø¨Û•Ú•ÛÙˆØ¨Û•Ø±", roleGuest: "Ø­Ø¬Ø²Ú©Ø±Ø¯Ù†ÛŒ Ù…ÛŒÙˆØ§Ù†", logout: "Ø¯Û•Ø±Ú†ÙˆÙˆÙ†",
                mName: "Ù†Ø§ÙˆÛŒ Ù†Û•Ø®Û†Ø´", mAge: "ØªÛ•Ù…Û•Ù†", btnSave: "Ø¬ÛÚ¯ÛŒØ±Ú©Ø±Ø¯Ù†", btnCancel: "Ù¾Ø§Ø´Ú¯Û•Ø²Ø¨ÙˆÙˆÙ†Û•ÙˆÛ•",
                rName: "Ù†Ø§Ùˆ", rDoc: "Ù¾Ø²ÛŒØ´Ú©", rTime: "Ú©Ø§Øª", rPrice: "Ù†Ø±Ø®", search: "Ú¯Û•Ú•Ø§Ù† Ù„Û• Ù„ÛŒØ³ØªÛ•Ú©Û•...",
                cols: ["ØªÚ©Øª#", "Ù†Û•Ø®Û†Ø´", "ØªÛ•Ù…Û•Ù†", "Ù¾Ø²ÛŒØ´Ú©", "Ú©Ø§Øª", "Ù†Ø±Ø®", "Ø³Ú•ÛŒÙ†Û•ÙˆÛ•"],
                doctors: [
                    { id: 1, name: "Ø¯. Ø¦Û•Ø­Ù…Û•Ø¯", spec: "Ø¯Úµ", price: "15,000" },
                    { id: 2, name: "Ø¯. Ø³Ø§Ø±Û•", spec: "Ù…Ù†Ø¯Ø§ÚµØ§Ù†", price: "10,000" },
                    { id: 3, name: "Ø¯. Ø®Ø§Ù„ÛŒØ¯", spec: "Ø¯Ø¯Ø§Ù†", price: "15,000" },
                    { id: 4, name: "Ø¯. Ù‡ÛÙ…Ù†", spec: "Ú¯Ø´ØªÛŒ", price: "5,000" }
                ]
            },
            en: {
                roleAdmin: "ADMIN PANEL", roleGuest: "GUEST BOOKING", logout: "Logout",
                mName: "Full Patient Name", mAge: "Age", btnSave: "Confirm", btnCancel: "Cancel",
                rName: "Name", rDoc: "Doctor", rTime: "Time", rPrice: "Price", search: "Search appointments...",
                cols: ["Tkt#", "Patient", "Age", "Doctor", "Time", "Price", "Del"],
                doctors: [
                    { id: 1, name: "Dr. Ahmed", spec: "Heart", price: "15,000" },
                    { id: 2, name: "Dr. Sara", spec: "Kids", price: "10,000" },
                    { id: 3, name: "Dr. Khalid", spec: "Dentist", price: "15,000" },
                    { id: 4, name: "Dr. Hemin", spec: "General", price: "5,000" }
                ]
            }
        };

        window.onload = function() {
            const session = localStorage.getItem('clinic_session');
            if (session) {
                const data = JSON.parse(session);
                if ((new Date().getTime() - data.time) / 3600000 < 24) login(data.role);
            }
            // Real-time sync: Check for new bookings every 3 seconds
            setInterval(() => {
                const latestDb = JSON.parse(localStorage.getItem('clinic_final_v11')) || [];
                if (latestDb.length !== db.length) {
                    db = latestDb;
                    if(currentUserRole === 'admin') updateTable();
                }
            }, 3000);
        };

        function checkAdmin() {
            if (prompt("Password / ØªÛÙ¾Û•Ú•Û•ÙˆØ´Û• / ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:") === "9898") {
                localStorage.setItem('clinic_session', JSON.stringify({role:'admin', time: new Date().getTime()}));
                login('admin');
            }
        }

        function login(role) {
            currentUserRole = role;
            document.getElementById('loginOverlay').style.display = 'none';
            render();
        }

        function logout() { localStorage.removeItem('clinic_session'); location.reload(); }

        function render() {
            const d = ui[lang];
            document.body.className = lang === 'en' ? 'ltr' : 'rtl';
            document.getElementById('roleDisplay').innerText = currentUserRole === 'admin' ? d.roleAdmin : d.roleGuest;
            document.getElementById('btnLogout').innerText = d.logout;
            document.getElementById('pName').placeholder = d.mName;
            document.getElementById('pAge').placeholder = d.mAge;
            document.getElementById('btnSave').innerText = d.btnSave;
            document.getElementById('btnCancel').innerText = d.btnCancel;
            document.getElementById('searchInput').placeholder = d.search;
            document.getElementById('tableHead').innerHTML = d.cols.map(c => `<th>${c}</th>`).join('');
            
            document.getElementById('rLabName').innerText = d.rName;
            document.getElementById('rLabDoc').innerText = d.rDoc;
            document.getElementById('rLabTime').innerText = d.rTime;
            document.getElementById('rLabPrice').innerText = d.rPrice;

            if(currentUserRole === 'admin') document.getElementById('adminArea').classList.remove('hidden');
            else document.getElementById('adminArea').classList.add('hidden');

            document.getElementById('doctorsGrid').innerHTML = d.doctors.map(doc => `
                <div class="card" onclick="openModal(${doc.id})">
                    <h3 style="margin:0;">${doc.name}</h3><p style="font-size:0.6rem; color:#94a3b8;">${doc.spec}</p>
                    <div class="price-tag">${doc.price} IQD</div>
                </div>
            `).join('');
            updateTable();
        }

        function openModal(id) { 
            selDoc = ui[lang].doctors.find(x => x.id === id); 
            document.getElementById('mTitle').innerText = selDoc.name;
            document.getElementById('modal').style.display = 'flex'; 
        }

        function confirmBooking() {
            const name = document.getElementById('pName').value, age = document.getElementById('pAge').value, time = document.getElementById('pTime').value;
            if(!name || !age || !time) return;
            
            const booking = { id: Date.now(), tkt: db.length + 1, user: name, age: age, doc: selDoc.name, price: selDoc.price, time: time.replace('T', ' ') };
            db.push(booking);
            localStorage.setItem('clinic_final_v11', JSON.stringify(db));
            
            document.getElementById('rName').innerText = booking.user;
            document.getElementById('rDoc').innerText = booking.doc;
            document.getElementById('rTime').innerText = booking.time;
            document.getElementById('rPrice').innerText = booking.price + " IQD";
            
            document.getElementById('pName').value = ''; document.getElementById('pAge').value = '';
            document.getElementById('modal').style.display = 'none';
            document.getElementById('receiptModal').style.display = 'flex';
            updateTable();
        }

        function updateTable() {
            if(currentUserRole !== 'admin') return;
            document.getElementById('apptBody').innerHTML = db.map(a => `
                <tr><td>#${a.tkt}</td><td>${a.user}</td><td>${a.age}</td><td><b>${a.doc}</b></td><td>${a.time}</td><td>${a.price}</td>
                <td><button onclick="del(${a.id})" style="color:red; border:none; background:none; cursor:pointer; font-weight:bold;">X</button></td></tr>
            `).join('');
        }

        function filterTable() {
            let val = document.getElementById("searchInput").value.toLowerCase();
            document.querySelectorAll("#apptBody tr").forEach(tr => tr.style.display = tr.innerText.toLowerCase().includes(val) ? "" : "none");
        }

        function del(id) { if(confirm("Delete this appointment?")) { db = db.filter(x => x.id !== id); localStorage.setItem('clinic_final_v11', JSON.stringify(db)); updateTable(); } }
        function setLang(l) { lang = l; render(); }
        function closeModal() { document.getElementById('modal').style.display = 'none'; }
        function toggleTheme() { document.body.setAttribute('data-theme', document.body.getAttribute('data-theme') === 'dark' ? '' : 'dark'); }
    </script>
</body>
</html>
